#===============================================================================
# vim: softtabstop=2 shiftwidth=2 expandtab fenc=utf-8 cc=81 tw=80
#===============================================================================
#
# RECIPE: wheezy_amd64.yaml 
# 
# DESCRIPTION: This recipe build an appliance of a complete debian server 
# 
# WARNING: autologin means anyone booting this image get acces WITHOUT password
#
#===============================================================================
---
# Global variables use by Kameleon engine and steps
global:
  # Where Kameleon stores tmp files and appliances
  workdir_base: /img/kameleon/wheezy_amd64/

  # Where Kameleon store the checkpoint file
  checkpoint_file:  /img/kameleon/checkpoint/wheezy_amd64.tgz

  # Distribution
  distrib: debian

  # Architechture 
  arch: amd64
  
  # You can define your own global variables here...

# Bootstrap the new system and create context
bootstrap:
  - bootstrap_static:
    - debian_version_name: wheezy
    - distrib_repository: http://ftp.fr.debian.org/debian/

# Install and configuration steps
# WARNING: should be independante from the build context
setup:
  # Install
  - software_install:
    - extra_packages: "vim bash-completion"
  - kernel_install

  # Configuration
  - system_config:
    - network_hostname: mydebian
  - make_swap
  - network_config
  - keyboard_config:
    - layout: fr
  - create_user:
    - user_name: kameleon
    - user_group: admin
    # set to "kameleon" use the create_passwd.py script to set your own password 
    - user_password: '$6$76krqNHd2/VeQZDC$1E9wrN3Sk6sM2vk2wUmqi3zOTkDZokb/ysajArMpYsKzq2/lI/OhQTAg3ow.mflbQOWku2SX4EqZ3yKHTAcdE0'
  - generate_user_ssh_key
    - generated_rsa_pub_dir: /img/kameleon/keys
  - autologin
  - root_passwd
  - root_ssh_config

# Export the generated appliance in the format of your choice
export:
  - clean_appliance
  - build_appliance:
    - output_environment_file_system_type: ext4
    - img_size: 2G #(see man fallocate)
  - save_appliance:
    - save_as_raw
    - save_as_vmdk


# # Bootstrap
- debootstrap:
  - check_cmd_out: debootstrap chroot
  - on_bootstrap_init:
    - exec_out: export DEBIAN_FRONTEND=noninteractive
  - exec_out: mkdir -p $(dirname "$$archive_file")
  - exec_out: mkdir -p "$$rootfs"
  - exec_out: test ! -f "$$archive_file" || tar zxf "$$archive_file" -C "$$rootfs"
  - exec_out: test -f "$$archive_file" || debootstrap --arch=$$arch --include="$$include" $$version_name $$rootfs $$repository
  - exec_out: test -f "$$archive_file" || tar zcf "$$archive_file" -C "$$rootfs" --numeric-owner --one-file-system .
  - exec_out: cat /etc/resolv.conf > $$rootfs/etc/resolv.conf
- mount_chroot:
  - exec_out: mount -o bind /dev  $$rootfs/dev
  - exec_out: mount -o bind /dev/pts $$rootfs/dev/pts
  - exec_out: mount -o bind /proc  $$rootfs/proc
  - exec_out: mount -o bind /sys  $$rootfs/sys
  - on_setup_init:
    - exec_in: export DEBIAN_FRONTEND=noninteractive
  - on_export_clean:
    - exec_out: echo "umount $$rootfs/sys..." ; mountpoint -q $$rootfs/sys && umount -f -l $$rootfs/sys  || true
    - exec_out: echo "umount $$rootfs/proc..." ; mountpoint -q $$rootfs/proc && umount  -f -l $$rootfs/proc  || true
    - exec_out: echo "umount $$rootfs/dev/pts..." ; mountpoint -q $$rootfs/dev/pts && umount -f -l $$rootfs/dev/pts  || true
    - exec_out: echo "umount $$rootfs/dev..." ; mountpoint -q $$rootfs/dev && umount -f -l $$rootfs/dev  || true

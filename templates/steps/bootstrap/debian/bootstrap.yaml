# # Bootstrap
- debootstrap:
  - check_cmd: debootstrap
  - exec_local: |
      export tgz_bootstrap_file=$(echo "$$workdir/../""/bootstrap/""$$distrib""_$$debian_version_name""_$$arch"".tar.gz")
      mkdir -p $(dirname $tgz_bootstrap_file)
      if [ ! -f "$tgz_bootstrap_file" ]
      then
          debootstrap --arch=$$arch $$debian_version_name $$rootfs $$distrib_repository
          tar zcf $tgz_bootstrap_file -C $$rootfs --numeric-owner --one-file-system .
      else
          tar zxf $tgz_bootstrap_file -C $$rootfs
          cp -f /etc/resolv.conf $$rootfs/etc
      fi
- mount_chroot:
  - exec_local: mount -o bind /dev  $$rootfs/dev
  - exec_local: mount -o bind /dev/pts $$rootfs/dev/pts
  - exec_local: mount -o bind /proc  $$rootfs/proc
  - exec_local: mount -o bind /sys  $$rootfs/sys
  - on_setup_clean:
    - exec_local: "mountpoint -q $$rootfs/sys && umount $$rootfs/sys"
    - exec_local: "mountpoint -q $$rootfs/proc && umount $$rootfs/proc"
    - exec_local: "mountpoint -q $$rootfs/dev/pts && umount $$rootfs/dev/pts"
    - exec_local: "mountpoint -q $$rootfs/dev && umount $$rootfs/dev"


# # Bootstrap
- include: >
    yum initscripts passwd rsyslog vim-minimal dhclient chkconfig rootfiles
    policycoreutils fedora-release openssh-server net-tools nc traceroute
- bootstrap_fedora:
  - check_cmd_out: yum
  - check_cmd_out: curl
  - exec_out: test -f "$$rootfs_archive" || mkdir -p $(dirname "$$rootfs_archive")
  - exec_out: test -f "$$rootfs_archive" || ROOTFS=$(dirname "$$rootfs_archive")/rootfs
  - exec_out: test -f "$$rootfs_archive" || mkdir -p $ROOTFS
  - exec_out: test -f "$$rootfs_archive" || echo "Fetching release mirror"
  - exec_out: test -f "$$rootfs_archive" || MIRROR_URL=$(curl -s -S -f "$$mirrorlist_url" | head -n2 | tail -n1)
  - exec_out: test -f "$$rootfs_archive" || RELEASE_URL="$MIRROR_URL/Packages/f/fedora-release-$${release}-1.noarch.rpm"
  - exec_out: test -f "$$rootfs_archive" || echo "Fetching from $RELEASE_URL"
  - exec_out: test -f "$$rootfs_archive" || curl -sf "$RELEASE_URL" > "$(basename $RELEASE_URL)" 2> /dev/null
  - exec_out: test -f "$$rootfs_archive" || mkdir -p $ROOTFS/var/lib/rpm
  - exec_out: test -f "$$rootfs_archive" || rpm --root $ROOTFS --initdb
  - exec_out: test -f "$$rootfs_archive" || rpm --root $ROOTFS -ivh "$(basename $RELEASE_URL)"
  - exec_out: test -f "$$rootfs_archive" || yum --installroot $ROOTFS -y --nogpgcheck install $$include
  - exec_out: test -f "$$rootfs_archive" || tar zcf "$$rootfs_archive" -C "$ROOTFS" --numeric-owner --one-file-system .
  - exec_out: test -f "$$rootfs_archive" || rm -fr $ROOTFS

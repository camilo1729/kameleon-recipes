# # Bootstrap
- configure_sshd:
  - check_cmd_out: docker
  - exec_out: echo -e  'y\n' | ssh-keygen -q -t dsa -f insecure_ssh_dsa_key -N ''
  - exec_out: |
      CID=$(docker run --dns $$dns -d $$image \
            /bin/bash -c "rm -fr /root/.ssh ; \
                          mkdir -p /root/.ssh ; \ 
                          ssh-keygen -q -t dsa -f /root/.ssh/id_dsa -N ''")
  - exec_out: docker commit $CID $$image
  - exec_out: |
      CID=$(docker run --dns $$dns -d -v "$(pwd):/tmp" $$image  \
      /bin/bash -c "cat /tmp/insecure_ssh_dsa_key.pub > /root/.ssh/authorized_keys")
  - exec_out: docker commit $CID $$image

- start_sshd:
  - on_checkpoint: redo
  - exec_out: CID=$(docker run -d -p 22 -i --dns $$dns $$image /bin/bash -c "mkdir /var/run/sshd ; /usr/sbin/sshd -D")
  - exec_out: docker commit $CID $$image
  - exec_out: CONTAINER_PORT=$(docker port $CID 22)
  - exec_out: echo $CONTAINER_PORT | cut -d':' -f2 > CONTAINER_PORT
  - exec_out: echo $CID > CONTAINER_ID

  - exec_out: fail This is an user breakpoint
